<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<style id="auth-veil">body{visibility:hidden;background:#FAFAFA}</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Milestone 1 â€” Vendor Onboarding & Shop Registration</title>
<style>
:root {
  --p:#6C3DF4; --pl:#EDE9FF; --g:#22C55E; --gl:#DCFCE7;
  --o:#F97316; --ol:#FFF7ED; --b:#3B82F6; --bl:#EFF6FF;
  --r:#EF4444; --rl:#FEF2F2; --th:#7C3AED; --thl:#F5F3FF;
  --gray:#6B7280; --light:#F9FAFB; --border:#E5E7EB; --text:#111827; --ts:#6B7280;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;font-size:14px;color:var(--text);background:#FAFAFA;line-height:1.6;}
.page{max-width:1120px;margin:0 auto;padding:36px 24px 80px;}

/* Header */
.doc-header{background:linear-gradient(135deg,var(--p) 0%,#4F46E5 100%);color:white;padding:28px 36px;border-radius:16px;margin-bottom:32px;}
.doc-header h1{font-size:24px;font-weight:700;margin-bottom:4px;}
.doc-header p{opacity:.85;font-size:13px;}
.pills{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px;}
.pill{background:rgba(255,255,255,.18);padding:3px 12px;border-radius:20px;font-size:11px;font-weight:500;}
.pill.out{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.3);}

/* Scope Banner */
.scope-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:32px;}
.scope-box{border-radius:10px;padding:14px 18px;font-size:13px;}
.scope-in{background:var(--gl);border:1px solid var(--g);}
.scope-out{background:var(--rl);border:1px solid var(--r);}
.scope-box h4{font-size:12px;font-weight:700;margin-bottom:6px;text-transform:uppercase;letter-spacing:.05em;}
.scope-in h4{color:#15803D;} .scope-out h4{color:#DC2626;}
.scope-box ul{padding-left:16px;} .scope-box li{margin-bottom:2px;}

/* Journey Strip */
.journey{background:white;border:1px solid var(--border);border-radius:12px;padding:20px 24px;margin-bottom:32px;overflow-x:auto;}
.journey-title{font-weight:700;font-size:13px;color:var(--ts);margin-bottom:14px;text-transform:uppercase;letter-spacing:.05em;}
.jsteps{display:flex;align-items:center;gap:0;min-width:max-content;}
.jstep{text-align:center;min-width:80px;}
.jstep-num{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 4px;font-size:12px;font-weight:700;}
.jstep-num.auth{background:#EFF6FF;color:#1D4ED8;border:2px solid #93C5FD;}
.jstep-num.step{background:var(--pl);color:var(--p);border:2px solid var(--p);}
.jstep-num.opt{background:#FFF7ED;color:#C2410C;border:2px dashed #FB923C;}
.jstep-num.done{background:var(--gl);color:#15803D;border:2px solid var(--g);}
.jstep-label{font-size:10px;color:var(--ts);font-weight:500;line-height:1.3;}
.jarrow{color:#CBD5E1;font-size:18px;padding:0 4px;align-self:flex-start;margin-top:6px;}
.m1-badge{background:var(--g);color:white;font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;margin-top:4px;display:inline-block;}

/* Section */
.section{margin-bottom:44px;}
.sec-title{font-size:17px;font-weight:700;border-bottom:2px solid var(--border);padding-bottom:10px;margin-bottom:18px;display:flex;align-items:center;gap:10px;}
.sec-num{width:26px;height:26px;border-radius:50%;background:var(--p);color:white;font-size:12px;font-weight:700;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;}
.sec-sub{font-size:12px;color:var(--ts);margin-top:-12px;margin-bottom:18px;}

/* Screen Pair */
.screen-pair{display:grid;grid-template-columns:240px 1fr;gap:24px;margin-bottom:24px;align-items:start;}
.screen-mock{border:2.5px solid #1F2937;border-radius:24px;overflow:hidden;background:white;box-shadow:0 4px 16px rgba(0,0,0,.12);}
.s-bar{background:#1F2937;color:#9CA3AF;font-size:9px;padding:5px 14px;display:flex;justify-content:space-between;}
.s-nav{background:white;border-bottom:1px solid var(--border);padding:10px 14px;font-weight:600;font-size:12px;display:flex;align-items:center;gap:8px;}
.s-nav .back{color:var(--p);font-size:11px;}
.s-prog{background:var(--light);padding:6px 14px;font-size:10px;color:var(--ts);}
.s-prog-bar{height:3px;background:var(--border);border-radius:2px;margin-top:4px;}
.s-prog-fill{height:3px;background:var(--p);border-radius:2px;}
.s-body{padding:14px;min-height:180px;background:var(--light);}
.s-field{background:white;border:1px solid var(--border);border-radius:8px;padding:8px 10px;margin-bottom:8px;font-size:11px;}
.s-field-label{font-size:9px;color:var(--ts);text-transform:uppercase;letter-spacing:.05em;margin-bottom:2px;}
.s-field-val{color:var(--ts);font-style:italic;}
.s-field-val.filled{color:var(--text);font-style:normal;}
.s-chip-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px;}
.s-chip{font-size:10px;padding:3px 8px;border-radius:12px;border:1px solid var(--border);background:white;}
.s-chip.sel{background:var(--pl);border-color:var(--p);color:var(--p);font-weight:600;}
.s-card{background:white;border:1px solid var(--border);border-radius:8px;padding:8px 10px;margin-bottom:6px;font-size:10px;}
.s-card-row{display:flex;align-items:center;gap:6px;}
.s-map{background:#E2E8F0;border-radius:8px;height:80px;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:8px;position:relative;}
.s-map-label{position:absolute;bottom:4px;right:6px;font-size:9px;color:#475569;background:white;padding:2px 5px;border-radius:4px;}
.s-cta{padding:10px 14px;border-top:1px solid var(--border);background:white;}
.s-btn{background:var(--p);color:white;border-radius:8px;padding:8px;text-align:center;font-size:11px;font-weight:600;}
.s-btn.secondary{background:white;color:var(--p);border:1px solid var(--p);}
.s-thiya{background:var(--thl);border:1px solid #DDD6FE;border-radius:8px;padding:6px 10px;margin-bottom:8px;font-size:10px;display:flex;align-items:center;gap:6px;}
.s-thiya-orb{width:24px;height:24px;border-radius:50%;background:var(--th);display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0;}
.s-badge{display:inline-block;font-size:9px;padding:2px 6px;border-radius:4px;font-weight:600;}
.s-badge.req{background:#FEF2F2;color:#DC2626;}
.s-badge.opt{background:#F0FDF4;color:#15803D;}
.s-badge.pend{background:#FFFBEB;color:#B45309;}

/* Spec Side */
.spec{background:white;border:1px solid var(--border);border-radius:12px;padding:18px;}
.spec-section{margin-bottom:14px;}
.spec-section:last-child{margin-bottom:0;}
.spec-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(--ts);margin-bottom:6px;}
.spec-label.api{color:var(--b);}
.spec-label.thiya{color:var(--th);}
.spec-label.edge{color:var(--o);}
.api-block{background:#0F172A;color:#E2E8F0;border-radius:8px;padding:10px 12px;font-family:'Courier New',monospace;font-size:11px;line-height:1.7;}
.api-block .method{color:#86EFAC;}
.api-block .path{color:#93C5FD;}
.api-block .key{color:#FCD34D;}
.api-block .val{color:#E2E8F0;}
.api-block .comment{color:#64748B;}
.field-list{font-size:12px;}
.field-list li{display:flex;gap:8px;align-items:baseline;padding:3px 0;border-bottom:1px solid var(--border);}
.field-list li:last-child{border:none;}
.field-name{font-weight:600;color:var(--text);min-width:110px;}
.field-desc{color:var(--ts);}
.badge{font-size:9px;padding:1px 6px;border-radius:4px;font-weight:700;white-space:nowrap;}
.badge.req{background:#FEF2F2;color:#DC2626;}
.badge.opt{background:#F0FDF4;color:#15803D;}
.badge.auto{background:var(--pl);color:var(--p);}

/* Note Boxes */
.note{display:flex;gap:10px;padding:10px 14px;border-radius:8px;margin-bottom:10px;font-size:12px;line-height:1.6;}
.note.info{background:var(--bl);border-left:3px solid var(--b);}
.note.warn{background:var(--ol);border-left:3px solid var(--o);}
.note.success{background:var(--gl);border-left:3px solid var(--g);}
.note.danger{background:var(--rl);border-left:3px solid var(--r);}
.note.thiya{background:var(--thl);border-left:3px solid var(--th);}
.note-icon{font-size:15px;flex-shrink:0;margin-top:1px;}

/* Thiya Flow */
.thiya-flow{background:var(--thl);border:1px solid #DDD6FE;border-radius:12px;padding:16px;margin-bottom:16px;}
.tf-header{display:flex;align-items:center;gap:8px;margin-bottom:12px;}
.tf-orb{width:32px;height:32px;border-radius:50%;background:var(--th);color:white;display:flex;align-items:center;justify-content:center;font-size:16px;}
.tf-title{font-weight:700;font-size:13px;color:var(--th);}
.tf-subtitle{font-size:11px;color:#6D28D9;}
.tf-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.tf-col{}
.tf-col-label{font-size:10px;font-weight:700;text-transform:uppercase;color:var(--th);margin-bottom:6px;letter-spacing:.05em;}
.bubble{border-radius:12px;padding:10px 12px;margin-bottom:6px;font-size:12px;}
.bubble.vendor{background:#F1F5F9;border-bottom-left-radius:3px;}
.bubble.thiya{background:var(--th);color:white;border-bottom-right-radius:3px;}
.tf-card{background:white;border-radius:10px;padding:12px;border:1px solid #DDD6FE;}
.tf-card-title{font-weight:600;font-size:12px;margin-bottom:8px;color:var(--th);}
.tf-fill-row{display:flex;gap:6px;align-items:center;font-size:11px;padding:3px 0;}
.tf-fill-row .check{color:var(--g);font-weight:700;}
.tf-btns{display:flex;gap:8px;margin-top:10px;}
.tf-btn-confirm{background:var(--th);color:white;border-radius:8px;padding:6px 12px;font-size:11px;font-weight:600;}
.tf-btn-edit{background:white;color:var(--th);border:1px solid var(--th);border-radius:8px;padding:6px 12px;font-size:11px;}

/* State Machine */
.state-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:16px;}
.state-machine{background:white;border:1px solid var(--border);border-radius:10px;padding:14px;}
.state-machine h4{font-size:12px;font-weight:700;margin-bottom:10px;color:var(--ts);text-transform:uppercase;letter-spacing:.05em;}
.state-flow{font-family:'Courier New',monospace;font-size:11px;line-height:1.8;color:var(--text);}

/* Tables */
.tbl{width:100%;border-collapse:collapse;font-size:12px;margin-bottom:16px;}
.tbl th{background:var(--light);text-align:left;padding:8px 12px;border:1px solid var(--border);font-weight:600;font-size:11px;}
.tbl td{padding:7px 12px;border:1px solid var(--border);vertical-align:top;}
.tbl tr:nth-child(even) td{background:#FAFAFA;}
.code{font-family:'Courier New',monospace;background:var(--light);padding:2px 5px;border-radius:4px;font-size:11px;}

/* Plan Comparison */
.plan-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px;}
.plan-card{border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;}
.plan-card.current{border-color:var(--p);background:var(--pl);}
.plan-name{font-weight:700;font-size:13px;margin-bottom:2px;}
.plan-price{font-size:12px;color:var(--ts);margin-bottom:8px;}
.plan-limit{font-size:11px;padding:3px 0;border-bottom:1px solid var(--border);}
.plan-limit:last-child{border:none;}
.plan-limit .val{font-weight:600;}

/* Returning user */
.dashboard-nudge{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;}
.nudge-card{border-radius:8px;padding:12px;font-size:12px;}
.nudge-card.profile{background:#FFF7ED;border:1px solid #FED7AA;}
.nudge-card.kyc{background:#FEF2F2;border:1px solid #FECACA;}
.nudge-card.plan{background:var(--bl);border:1px solid #BFDBFE;}
.nudge-card h4{font-weight:700;font-size:12px;margin-bottom:4px;}

/* Responsive */
@media(max-width:700px){
  .screen-pair{grid-template-columns:1fr;}
  .scope-grid,.tf-row,.state-grid,.plan-grid,.dashboard-nudge{grid-template-columns:1fr;}
}
</style>
</head>
<body>
<div class="page">

<!-- â•â•â• HEADER â•â•â• -->
<div class="doc-header">
  <h1>Vendor App â€” Onboarding & Shop Registration</h1>
  <p>UX & Development Guide Â· Milestone 1 of 2 Â· Backend: http://localhost:8080 Â· Swagger: /swagger-ui/index.html</p>
  <div class="pills">
    <span class="pill">Audience: UX Designer + Flutter Developer</span>
    <span class="pill">Auth: OTP â†’ JWT Bearer</span>
    <span class="pill">AI: Thiya â€” Voice First</span>
    <span class="pill out">âŒ Does NOT cover: Catalog, Go Live</span>
  </div>
</div>

<!-- â•â•â• SCOPE â•â•â• -->
<div class="scope-grid">
  <div class="scope-box scope-in">
    <h4>âœ… Covered in This Guide</h4>
    <ul>
      <li>App launch & OTP authentication</li>
      <li>Auto vendor profile creation (backend)</li>
      <li>Business profile setup (Step 1)</li>
      <li>Service category selection (Step 2)</li>
      <li>Service zone setup (Step 3)</li>
      <li>KYC document upload (Step 4)</li>
      <li>Plan selection (optional)</li>
      <li>Returning vendor login flow</li>
      <li>Token lifecycle & session restore</li>
    </ul>
  </div>
  <div class="scope-box scope-out">
    <h4>âŒ Not Covered Here</h4>
    <ul>
      <li>Product catalog setup â†’ see Guide 2</li>
      <li>Go Live â†’ see Guide 2</li>
      <li>Order management</li>
      <li>Consumer onboarding</li>
      <li>Subscription management</li>
      <li>Payment & Khata</li>
    </ul>
  </div>
</div>

<!-- â•â•â• JOURNEY MAP â•â•â• -->
<div class="journey">
  <div class="journey-title">Milestone 1 Journey â€” App Open â†’ Shop Registered</div>
  <div class="jsteps">
    <div class="jstep"><div class="jstep-num auth">1</div><div class="jstep-label">Splash<br>Landing</div></div>
    <div class="jarrow">â†’</div>
    <div class="jstep"><div class="jstep-num auth">2</div><div class="jstep-label">Enter<br>Phone</div></div>
    <div class="jarrow">â†’</div>
    <div class="jstep"><div class="jstep-num auth">3</div><div class="jstep-label">Verify<br>OTP</div></div>
    <div class="jarrow">â†’</div>
    <div class="jstep"><div class="jstep-num step">4</div><div class="jstep-label">Profile<br>Step 1</div></div>
    <div class="jarrow">â†’</div>
    <div class="jstep"><div class="jstep-num step">5</div><div class="jstep-label">Category<br>Step 2</div></div>
    <div class="jarrow">â†’</div>
    <div class="jstep"><div class="jstep-num step">6</div><div class="jstep-label">Zone<br>Step 3</div></div>
    <div class="jarrow">â†’</div>
    <div class="jstep"><div class="jstep-num step">7</div><div class="jstep-label">KYC<br>Step 4</div></div>
    <div class="jarrow">â†’</div>
    <div class="jstep"><div class="jstep-num opt">8</div><div class="jstep-label">Plan<br>Optional</div></div>
    <div class="jarrow">â†’</div>
    <div class="jstep"><div class="jstep-num done">âœ“</div><div class="jstep-label">Shop<br>Registered<div class="m1-badge">M1</div></div></div>
  </div>
</div>

<!-- â•â•â• SECTION 1: AUTH â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">1</span> Authentication â€” OTP Flow (Screens 1â€“3)</div>
  <p class="sec-sub">OTP handles both new signup and returning login. One flow, two outcomes based on the <code class="code">newUser</code> flag.</p>

  <div class="note info"><span class="note-icon">â„¹ï¸</span><div><strong>Backend auto-creates vendor on first OTP verify.</strong> When <code>registrationSource: "VENDOR_APP"</code> is sent, the backend fires <code>UserRegisteredEvent</code> â†’ creates a bare Vendor entity (status: ACTIVE, plan: FREE, kyc: NOT_APPLIED). No explicit "create account" step is needed in the UI.</div></div>

  <div class="screen-pair">
    <div class="screen-mock">
      <div class="s-bar"><span>9:41 AM</span><span>â—â—â— â–ªâ–ªâ–ª</span></div>
      <div class="s-body" style="padding:20px 14px;min-height:280px;display:flex;flex-direction:column;justify-content:space-between;">
        <div>
          <div style="text-align:center;padding:20px 0 12px;">
            <div style="font-size:32px;margin-bottom:6px;">ğŸ§¡</div>
            <div style="font-weight:700;font-size:14px;">Vinimay Vendor</div>
            <div style="font-size:10px;color:var(--ts);">Your local business, powered by AI</div>
          </div>
          <div class="s-thiya" style="justify-content:center;">
            <span class="s-thiya-orb">ğŸ¤</span>
            <span style="font-size:10px;color:var(--th);">Say your number or type below</span>
          </div>
          <div class="s-field">
            <div class="s-field-label">Mobile Number</div>
            <div style="display:flex;align-items:center;gap:6px;"><span style="font-size:11px;font-weight:600;">+91</span><span class="s-field-val">10-digit number</span></div>
          </div>
        </div>
        <div class="s-btn">Get OTP â†’</div>
      </div>
    </div>
    <div class="spec">
      <div class="spec-section">
        <div class="spec-label api">Screen 2 â€” Enter Phone</div>
        <div class="api-block">
<span class="method">POST</span> <span class="path">/api/v1/auth/otp/send</span>
<span class="comment">// No auth required</span>
{
  <span class="key">"phone"</span>: <span class="val">"9XXXXXXXXX"</span>,
  <span class="key">"registrationSource"</span>: <span class="val">"VENDOR_APP"</span>
}

<span class="comment">// Success â†’ OTP sent (expires 300s)</span>
<span class="comment">// 3 resends max, then 429 rate limit</span>
        </div>
      </div>
      <div class="spec-section">
        <div class="spec-label api">Screen 3 â€” Verify OTP</div>
        <div class="api-block">
<span class="method">POST</span> <span class="path">/api/v1/auth/otp/verify</span>
{
  <span class="key">"phone"</span>: <span class="val">"9XXXXXXXXX"</span>,
  <span class="key">"otp"</span>: <span class="val">"XXXXXX"</span>,
  <span class="key">"registrationSource"</span>: <span class="val">"VENDOR_APP"</span>
}

<span class="comment">// Response:</span>
{
  <span class="key">"accessToken"</span>: <span class="val">"eyJ..."</span>,
  <span class="key">"refreshToken"</span>: <span class="val">"eyJ..."</span>,
  <span class="key">"newUser"</span>: <span class="val">true / false</span> <span class="comment">â† KEY</span>
}
        </div>
      </div>
      <div class="spec-section">
        <div class="spec-label">Routing After Verify</div>
        <ul class="field-list">
          <li><span class="field-name">newUser: <strong>true</strong></span><span class="field-desc">â†’ Onboarding Step 1 (Screen 4)</span></li>
          <li><span class="field-name">newUser: <strong>false</strong></span><span class="field-desc">â†’ Dashboard directly</span></li>
        </ul>
      </div>
      <div class="note warn" style="margin-bottom:0"><span class="note-icon">âš ï¸</span><div><strong>Always send <code>registrationSource: "VENDOR_APP"</code></strong> in both OTP calls. Missing this breaks vendor auto-creation and role assignment.</div></div>
    </div>
  </div>

  <div class="note thiya"><span class="note-icon">ğŸ™ï¸</span><div><strong>Screen 1 â€” Thiya Voice (Splash):</strong> On first launch, Thiya introduces itself: <em>"Hi, I'm Thiya â€” your AI business assistant. Just tell me your phone number."</em> Voice picks up the number and auto-populates the field. Single confirm tap to send OTP.</div></div>
</div>

<!-- â•â•â• SECTION 2: STEP 1 PROFILE â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">2</span> Step 1 of 4 â€” Business Profile (Screen 4)</div>
  <p class="sec-sub">Thiya fills this screen with one voice sentence. The form exists as a fallback.</p>

  <div class="thiya-flow">
    <div class="tf-header">
      <div class="tf-orb">ğŸ¤</div>
      <div><div class="tf-title">Thiya Voice Flow â€” Profile Setup</div><div class="tf-subtitle">Primary interaction Â· Tap orb or say "Thiya"</div></div>
    </div>
    <div class="tf-row">
      <div class="tf-col">
        <div class="tf-col-label">Conversation</div>
        <div class="bubble thiya">Hi! Tell me your name and your shop or business name.</div>
        <div class="bubble vendor">"I'm Ramesh Sharma. My shop is Sharma Dairy."</div>
        <div class="bubble thiya">Got it! I've set up your profile. Want to add a photo?</div>
        <div class="bubble vendor">"No, skip for now."</div>
      </div>
      <div class="tf-col">
        <div class="tf-col-label">Auto-filled Preview Card</div>
        <div class="tf-card">
          <div class="tf-card-title">âœ¨ Here's what I filled in</div>
          <div class="tf-fill-row"><span class="check">âœ“</span><span>Owner Name: <strong>Ramesh Sharma</strong></span></div>
          <div class="tf-fill-row"><span class="check">âœ“</span><span>Business Name: <strong>Sharma Dairy</strong></span></div>
          <div class="tf-fill-row"><span class="check">âœ“</span><span>Language: Hindi (default)</span></div>
          <div class="tf-fill-row"><span style="color:var(--ts)">â—‹</span><span style="color:var(--ts)">Photo: skipped (add later)</span></div>
          <div class="tf-btns"><span class="tf-btn-confirm">Looks right!</span><span class="tf-btn-edit">Edit</span></div>
        </div>
      </div>
    </div>
  </div>

  <div class="screen-pair">
    <div class="screen-mock">
      <div class="s-bar"><span>9:43 AM</span><span>â—â—â— â–ªâ–ªâ–ª</span></div>
      <div class="s-nav"><span class="back">â†</span><span>Step 1 of 4 Â· Profile</span></div>
      <div class="s-prog">
        <div>Business Profile</div>
        <div class="s-prog-bar"><div class="s-prog-fill" style="width:25%"></div></div>
      </div>
      <div class="s-body">
        <div class="s-thiya"><span class="s-thiya-orb">ğŸ¤</span><span>Tap to speak your info</span></div>
        <div class="s-field"><div class="s-field-label">Owner Name <span class="s-badge req">Required</span></div><div class="s-field-val filled">Ramesh Sharma</div></div>
        <div class="s-field"><div class="s-field-label">Business / Shop Name <span class="s-badge req">Required</span></div><div class="s-field-val filled">Sharma Dairy</div></div>
        <div class="s-field"><div class="s-field-label">Profile Photo <span class="s-badge opt">Optional</span></div><div class="s-field-val">+ Upload photo</div></div>
        <div class="s-chip-row">
          <span class="s-chip sel">ğŸ‡®ğŸ‡³ Hindi</span>
          <span class="s-chip">English</span>
        </div>
      </div>
      <div class="s-cta"><div class="s-btn">Save & Next â†’</div></div>
    </div>
    <div class="spec">
      <div class="spec-section">
        <div class="spec-label api">API Call</div>
        <div class="api-block">
<span class="method">PATCH</span> <span class="path">/api/v1/vendor/profile/me</span>
<span class="comment">// Auth: Bearer token</span>
<span class="comment">// Partial update â€” only provided fields updated</span>
{
  <span class="key">"ownerName"</span>: <span class="val">"Ramesh Sharma"</span>,
  <span class="key">"businessName"</span>: <span class="val">"Sharma Dairy"</span>,
  <span class="key">"language"</span>: <span class="val">"HI"</span>,
  <span class="key">"profilePhotoFileId"</span>: <span class="val">"uuid"</span> <span class="comment">// optional</span>
}
        </div>
      </div>
      <div class="spec-section">
        <div class="spec-label">Fields</div>
        <ul class="field-list">
          <li><span class="field-name">ownerName</span><span class="badge req">Required</span><span class="field-desc" style="margin-left:4px;">max 100 chars</span></li>
          <li><span class="field-name">businessName</span><span class="badge req">Required</span><span class="field-desc" style="margin-left:4px;">max 150 chars</span></li>
          <li><span class="field-name">language</span><span class="badge opt">Optional</span><span class="field-desc" style="margin-left:4px;">HI (default) or EN</span></li>
          <li><span class="field-name">profilePhotoFileId</span><span class="badge opt">Optional</span><span class="field-desc" style="margin-left:4px;">Upload to storage first â†’ get fileId</span></li>
        </ul>
      </div>
      <div class="spec-section">
        <div class="spec-label edge">Edge Cases</div>
        <ul style="font-size:12px;padding-left:16px;">
          <li>Photo upload: POST to storage API â†’ get fileId â†’ include in PATCH. Never send raw file in profile PATCH.</li>
          <li>PATCH ignores null fields. Send only what changed.</li>
          <li>Vendor profile already exists from OTP step â€” this is an update, not create.</li>
          <li>If network fails: save locally, retry on next screen load.</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• SECTION 3: STEP 2 CATEGORIES â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">3</span> Step 2 of 4 â€” Service Categories (Screen 5)</div>
  <p class="sec-sub">What services does the vendor offer? Load from catalog, multi-select up to plan limit.</p>

  <div class="note warn"><span class="note-icon">âš ï¸</span><div><strong>FREE plan allows max 2 capabilities, but only 1 service zone total.</strong> If a vendor selects 2 categories on FREE, only one can have a service zone (meaning only one is discoverable to consumers). Show a clear nudge. The capability can be created without a zone, but it won't appear in consumer search until a zone is added (requires STARTER upgrade).</div></div>

  <div class="screen-pair">
    <div class="screen-mock">
      <div class="s-bar"><span>9:45 AM</span><span>â—â—â— â–ªâ–ªâ–ª</span></div>
      <div class="s-nav"><span class="back">â†</span><span>Step 2 of 4 Â· Your Services</span></div>
      <div class="s-prog">
        <div>Select what you sell or deliver</div>
        <div class="s-prog-bar"><div class="s-prog-fill" style="width:50%"></div></div>
      </div>
      <div class="s-body">
        <div class="s-thiya"><span class="s-thiya-orb">ğŸ¤</span><span>"I sell milk and tiffin"</span></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px;">
          <div style="border:2px solid var(--p);background:var(--pl);border-radius:8px;padding:8px;text-align:center;font-size:10px;"><div style="font-size:18px;">ğŸ¥›</div><div style="font-weight:600;">Milk Delivery</div><div style="color:var(--p);font-size:9px;">Daily Fixed</div></div>
          <div style="border:2px solid var(--p);background:var(--pl);border-radius:8px;padding:8px;text-align:center;font-size:10px;"><div style="font-size:18px;">ğŸ±</div><div style="font-weight:600;">Tiffin Service</div><div style="color:var(--p);font-size:9px;">Configurable</div></div>
          <div style="border:1px solid var(--border);background:white;border-radius:8px;padding:8px;text-align:center;font-size:10px;"><div style="font-size:18px;">ğŸ’§</div><div style="font-weight:600;">Water Can</div><div style="color:var(--ts);font-size:9px;">Configurable</div></div>
          <div style="border:1px solid var(--border);background:white;border-radius:8px;padding:8px;text-align:center;font-size:10px;"><div style="font-size:18px;">ğŸ§º</div><div style="font-weight:600;">Laundry</div><div style="color:var(--ts);font-size:9px;">Configurable</div></div>
        </div>
        <div style="font-size:9px;color:var(--ts);text-align:center;">2 selected Â· scroll to see all 10 services</div>
      </div>
      <div class="s-cta"><div class="s-btn">Next: Set Your Area â†’</div></div>
    </div>
    <div class="spec">
      <div class="spec-section">
        <div class="spec-label api">Load Catalog (Public â€” No Auth)</div>
        <div class="api-block">
<span class="method">GET</span> <span class="path">/api/v1/vendor/capabilities/catalog</span>
<span class="comment">// Returns all categories from capabilities.yml</span>

<span class="comment">// Response fields per category:</span>
{
  <span class="key">"categoryId"</span>: <span class="val">"MILK_DELIVERY"</span>,
  <span class="key">"displayName"</span>: <span class="val">"Milk Delivery"</span>,
  <span class="key">"family"</span>: <span class="val">"RECURRING_FIXED_PRICE"</span>,
  <span class="key">"icon"</span>: <span class="val">"milk"</span>,
  <span class="key">"defaultRadiusKm"</span>: <span class="val">3.0</span>,
  <span class="key">"maxRadiusKm"</span>: <span class="val">10.0</span>
}
        </div>
      </div>
      <div class="spec-section">
        <div class="spec-label">Available Categories</div>
        <table class="tbl">
          <tr><th>Category</th><th>Family</th><th>Max Radius</th></tr>
          <tr><td>MILK_DELIVERY ğŸ¥›</td><td>Fixed Price</td><td>10 km</td></tr>
          <tr><td>NEWSPAPER_DELIVERY ğŸ“°</td><td>Fixed Price</td><td>8 km</td></tr>
          <tr><td>FLOWER_DELIVERY ğŸŒ¸</td><td>Fixed Price</td><td>8 km</td></tr>
          <tr><td>TIFFIN_SERVICE ğŸ±</td><td>Configurable</td><td>15 km</td></tr>
          <tr><td>WATER_DELIVERY ğŸ’§</td><td>Configurable</td><td>15 km</td></tr>
          <tr><td>LAUNDRY_SERVICE ğŸ§º</td><td>Configurable</td><td>10 km</td></tr>
          <tr><td>GAS_CYLINDER_DELIVERY ğŸ”µ</td><td>Configurable</td><td>15 km</td></tr>
          <tr><td>PLUMBING_SERVICE ğŸ”§</td><td>Dynamic</td><td>20 km</td></tr>
          <tr><td>ELECTRICIAN_SERVICE âš¡</td><td>Dynamic</td><td>20 km</td></tr>
          <tr><td>CLEANING_SERVICE ğŸ§¹</td><td>Dynamic</td><td>15 km</td></tr>
        </table>
      </div>
      <div class="spec-section">
        <div class="spec-label edge">Plan Limit: Capabilities Allowed</div>
        <ul style="font-size:12px;padding-left:16px;">
          <li><strong>FREE:</strong> 2 capabilities, but <strong>only 1 service zone</strong> total</li>
          <li><strong>STARTER â‚¹299:</strong> 10 capabilities, 5 zones</li>
          <li><strong>GROWTH â‚¹799:</strong> Unlimited capabilities, 20 zones</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• SECTION 4: STEP 3 ZONE â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">4</span> Step 3 of 4 â€” Service Zone (Screen 6)</div>
  <p class="sec-sub">For each selected category, create the capability and set a delivery zone. This zone is what consumers see when searching for vendors near them.</p>

  <div class="thiya-flow">
    <div class="tf-header">
      <div class="tf-orb">ğŸ—ºï¸</div>
      <div><div class="tf-title">Thiya Voice Flow â€” Zone Setup</div><div class="tf-subtitle">Voice sets radius Â· Map updates in real-time</div></div>
    </div>
    <div class="tf-row">
      <div class="tf-col">
        <div class="tf-col-label">Conversation</div>
        <div class="bubble thiya">Where do you operate from? I can use your current location or you can drop a pin.</div>
        <div class="bubble vendor">"Use my current location."</div>
        <div class="bubble thiya">Got it â€” Kothrud, Pune. How far do you deliver milk?</div>
        <div class="bubble vendor">"About 3 kilometers around."</div>
        <div class="bubble thiya">Done! 3km zone set for Milk Delivery. Same for Tiffin?</div>
        <div class="bubble vendor">"Tiffin I deliver 5km, different area."</div>
      </div>
      <div class="tf-col">
        <div class="tf-col-label">Screen State</div>
        <div class="tf-card">
          <div class="tf-card-title">ğŸ¥› Milk Delivery Zone</div>
          <div class="tf-fill-row"><span class="check">âœ“</span><span>Center: Kothrud, Pune</span></div>
          <div class="tf-fill-row"><span class="check">âœ“</span><span>Radius: 3 km</span></div>
          <div style="font-size:10px;margin-top:8px;color:var(--ts);">Consumers within 3km will see you</div>
          <hr style="margin:8px 0;border-color:var(--border);">
          <div class="tf-card-title">ğŸ± Tiffin Service Zone</div>
          <div class="tf-fill-row"><span class="check">âœ“</span><span>Center: (set separately)</span></div>
          <div class="tf-fill-row"><span class="check">âœ“</span><span>Radius: 5 km</span></div>
        </div>
      </div>
    </div>
  </div>

  <div class="screen-pair">
    <div class="screen-mock">
      <div class="s-bar"><span>9:47 AM</span><span>â—â—â— â–ªâ–ªâ–ª</span></div>
      <div class="s-nav"><span class="back">â†</span><span>Step 3 of 4 Â· ğŸ¥› Milk Delivery</span></div>
      <div class="s-prog">
        <div>Set your delivery area</div>
        <div class="s-prog-bar"><div class="s-prog-fill" style="width:75%"></div></div>
      </div>
      <div class="s-body">
        <div class="s-map">ğŸ“<div class="s-map-label">Kothrud, Pune</div><div style="position:absolute;width:70px;height:70px;border:2px dashed #6C3DF4;border-radius:50%;opacity:.5;"></div></div>
        <div class="s-field"><div class="s-field-label">Radius (max 10 km for Milk)</div><div style="display:flex;align-items:center;gap:8px;font-size:12px;font-weight:600;"><span style="color:var(--p);">â—â”€â”€â”€â”€â”€â”€â—</span><span>3 km</span></div></div>
        <div class="s-field"><div class="s-field-label">Daily Capacity <span class="s-badge opt">Optional</span></div><div class="s-field-val filled">100 orders/day</div></div>
      </div>
      <div class="s-cta" style="display:flex;flex-direction:column;gap:6px;"><div class="s-btn">Save Zone &amp; Continue â†’</div></div>
    </div>
    <div class="spec">
      <div class="spec-section">
        <div class="spec-label api">Step A â€” Create Capability</div>
        <div class="api-block">
<span class="method">POST</span> <span class="path">/api/v1/vendor/capabilities/my</span>
<span class="comment">// Auth: Bearer token</span>
{
  <span class="key">"categoryId"</span>: <span class="val">"MILK_DELIVERY"</span>,
  <span class="key">"dailyCapacity"</span>: <span class="val">100</span>
}
<span class="comment">// Response â†’ capabilityId (save this!)</span>
        </div>
      </div>
      <div class="spec-section">
        <div class="spec-label api">Step B â€” Add Service Zone</div>
        <div class="api-block">
<span class="method">POST</span> <span class="path">/api/v1/vendor/capabilities/{capabilityId}/zones</span>
{
  <span class="key">"name"</span>: <span class="val">"Main Zone"</span>, <span class="comment">// optional</span>
  <span class="key">"latitude"</span>: <span class="val">18.5074</span>,
  <span class="key">"longitude"</span>: <span class="val">73.8077</span>,
  <span class="key">"radiusKm"</span>: <span class="val">3.0</span>,
  <span class="key">"priority"</span>: <span class="val">1</span>
}
        </div>
      </div>
      <div class="spec-section">
        <div class="spec-label edge">Key Rules</div>
        <ul style="font-size:12px;padding-left:16px;">
          <li>Call Step A â†’ Step B sequentially per category. Do NOT parallelize.</li>
          <li>Latitude/longitude from device GPS. If denied, show manual address input.</li>
          <li>radius must be â‰¤ category's <code class="code">maxRadiusKm</code>. Validate before API call.</li>
          <li>FREE plan: <strong>1 zone total.</strong> After saving the first zone, disable zone creation for other capabilities and show upgrade prompt.</li>
          <li>If vendor has 2 categories (FREE), create both capabilities but only add zone to the primary one. Other capability shows "Add zone â€” STARTER required".</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• SECTION 5: STEP 4 KYC â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">5</span> Step 4 of 4 â€” KYC Documents (Screen 7)</div>
  <p class="sec-sub">Identity verification for trust and payments. Upload â†’ backend stores fileId â†’ admin reviews. Vendor can skip and come back, but payment features stay locked until approved.</p>

  <div class="screen-pair">
    <div class="screen-mock">
      <div class="s-bar"><span>9:50 AM</span><span>â—â—â— â–ªâ–ªâ–ª</span></div>
      <div class="s-nav"><span class="back">â†</span><span>Step 4 of 4 Â· Verify Identity</span></div>
      <div class="s-prog">
        <div>KYC Documents</div>
        <div class="s-prog-bar"><div class="s-prog-fill" style="width:100%"></div></div>
      </div>
      <div class="s-body">
        <div class="s-card"><div class="s-card-row"><span style="font-size:16px;">ğŸªª</span><div><div style="font-weight:600;font-size:11px;">Aadhaar Card <span class="s-badge req">Required</span></div><div style="font-size:9px;color:var(--ts);">ID proof Â· uploaded âœ“</div></div><span style="margin-left:auto;color:var(--g);font-size:14px;">âœ“</span></div></div>
        <div class="s-card"><div class="s-card-row"><span style="font-size:16px;">ğŸ¦</span><div><div style="font-weight:600;font-size:11px;">Bank Account <span class="s-badge req">Required</span></div><div style="font-size:9px;color:var(--ts);">To receive payments</div></div><span style="margin-left:auto;font-size:14px;">+ Add</span></div></div>
        <div class="s-card"><div class="s-card-row"><span style="font-size:16px;">ğŸª™</span><div><div style="font-weight:600;font-size:11px;">PAN Card <span class="s-badge opt">Optional</span></div><div style="font-size:9px;color:var(--ts);">Tax purposes</div></div><span style="margin-left:auto;font-size:14px;">+ Add</span></div></div>
        <div class="s-card"><div class="s-card-row"><span style="font-size:16px;">ğŸ½ï¸</span><div><div style="font-weight:600;font-size:11px;">FSSAI License <span class="s-badge opt">Food only</span></div><div style="font-size:9px;color:var(--ts);">Tiffin/food vendors</div></div><span style="margin-left:auto;font-size:14px;">+ Add</span></div></div>
      </div>
      <div class="s-cta" style="display:flex;flex-direction:column;gap:6px;">
        <div class="s-btn">Submit for Review</div>
        <div class="s-btn secondary">Skip for now â†’</div>
      </div>
    </div>
    <div class="spec">
      <div class="spec-section">
        <div class="spec-label api">Upload Flow (2 Steps)</div>
        <div class="api-block">
<span class="comment">// Step 1 â€” Upload file to storage</span>
<span class="method">POST</span> <span class="path">/api/v1/storage/upload</span>
<span class="comment">// multipart/form-data: file, ownerType=KYC</span>
<span class="comment">// Response â†’ { "fileId": "uuid" }</span>

<span class="comment">// Step 2 â€” Submit KYC document</span>
<span class="method">POST</span> <span class="path">/api/v1/vendor/documents/my</span>
{
  <span class="key">"documentType"</span>: <span class="val">"AADHAAR"</span>,
  <span class="key">"fileId"</span>: <span class="val">"uuid-from-storage"</span>,
  <span class="key">"documentNumber"</span>: <span class="val">"XXXX XXXX XXXX"</span>
}
<span class="comment">// Status â†’ PENDING</span>
        </div>
      </div>
      <div class="spec-section">
        <div class="spec-label">Document Types</div>
        <table class="tbl">
          <tr><th>Type</th><th>Status</th><th>When Required</th></tr>
          <tr><td>AADHAAR</td><td><span class="badge req">Required</span></td><td>All vendors</td></tr>
          <tr><td>BANK_ACCOUNT</td><td><span class="badge req">Required</span></td><td>To receive payments</td></tr>
          <tr><td>PAN</td><td><span class="badge opt">Optional</span></td><td>Income tax compliance</td></tr>
          <tr><td>FSSAI</td><td><span class="badge opt">Food vendors</span></td><td>TIFFIN_SERVICE capability</td></tr>
          <tr><td>GST</td><td><span class="badge opt">Optional</span></td><td>If GST registered</td></tr>
        </table>
      </div>
      <div class="spec-section">
        <div class="spec-label edge">KYC Edge Cases</div>
        <ul style="font-size:12px;padding-left:16px;">
          <li>"Skip" allowed â†’ kycStatus stays NOT_APPLIED. Show lock icon on payment features.</li>
          <li>One document per type per vendor (422 if duplicate). Check list before upload.</li>
          <li>If TIFFIN_SERVICE selected â†’ show FSSAI as "Strongly Recommended" (not just optional).</li>
          <li>After rejection: GET /vendor/documents/my â†’ show reason â†’ PATCH .../resubmit?newFileId=...</li>
          <li>Max file size: enforce client-side before upload (suggest 5MB limit).</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• SECTION 6: PLAN + COMPLETE â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">6</span> Plan Selection (Optional) + Milestone 1 Complete (Screens 8â€“9)</div>

  <div class="plan-grid">
    <div class="plan-card current">
      <div class="plan-name">FREE</div>
      <div class="plan-price">â‚¹0 / month Â· Active âœ“</div>
      <div class="plan-limit"><span class="val">2</span> capabilities</div>
      <div class="plan-limit"><span class="val">1</span> service zone</div>
      <div class="plan-limit"><span class="val">5</span> products/capability</div>
      <div class="plan-limit"><span class="val">10</span> consumers</div>
    </div>
    <div class="plan-card">
      <div class="plan-name">STARTER</div>
      <div class="plan-price">â‚¹299 / month</div>
      <div class="plan-limit"><span class="val">10</span> capabilities</div>
      <div class="plan-limit"><span class="val">5</span> service zones</div>
      <div class="plan-limit"><span class="val">50</span> products/capability</div>
      <div class="plan-limit"><span class="val">100</span> consumers</div>
    </div>
    <div class="plan-card">
      <div class="plan-name">GROWTH</div>
      <div class="plan-price">â‚¹799 / month</div>
      <div class="plan-limit"><span class="val">âˆ</span> capabilities</div>
      <div class="plan-limit"><span class="val">20</span> service zones</div>
      <div class="plan-limit"><span class="val">âˆ</span> products</div>
      <div class="plan-limit"><span class="val">âˆ</span> consumers</div>
    </div>
    <div class="plan-card">
      <div class="plan-name">ENTERPRISE</div>
      <div class="plan-price">Custom pricing</div>
      <div class="plan-limit"><span class="val">âˆ</span> everything</div>
      <div class="plan-limit">Advanced analytics</div>
      <div class="plan-limit">Dedicated support</div>
      <div class="plan-limit">Contact sales</div>
    </div>
  </div>

  <div class="note info" style="margin-bottom:12px;"><span class="note-icon">â„¹ï¸</span><div>Plan selection screen (Screen 8) is optional during onboarding. Free is active by default. If vendor wants to upgrade: <code class="code">POST /api/v1/vendors/{vendorId}/plan/requests?requestedTier=STARTER</code>. Plan change goes through admin approval.</div></div>

  <div class="note success"><span class="note-icon">ğŸ‰</span><div><strong>Screen 9 â€” Milestone 1 Complete.</strong> Show a celebration screen with summary: services registered, zone radius, KYC status. CTA: <strong>"Now set up your product catalog â†’"</strong> â€” this takes vendor to Milestone 2 (Guide 2). Also accessible anytime from dashboard.</div></div>
</div>

<!-- â•â•â• SECTION 7: RETURNING USER â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">7</span> Returning Vendor Flow</div>
  <p class="sec-sub">newUser: false â†’ Dashboard immediately. Check profile state and show smart nudges.</p>

  <div class="api-block" style="margin-bottom:16px;">
<span class="comment">// On dashboard load, always call:</span>
<span class="method">GET</span> <span class="path">/api/v1/vendor/profile/me</span> <span class="comment">â†’ check completeness + status</span>
<span class="method">GET</span> <span class="path">/api/v1/vendor/capabilities/my</span> <span class="comment">â†’ show active services</span>
<span class="method">GET</span> <span class="path">/api/v1/vendor/documents/my</span> <span class="comment">â†’ check KYC status</span>
  </div>

  <div class="dashboard-nudge">
    <div class="nudge-card profile">
      <h4>ğŸ“ Profile incomplete</h4>
      <p>Show if ownerName or businessName is null. Banner: "Complete your profile to appear in search results." CTA â†’ Profile edit screen.</p>
    </div>
    <div class="nudge-card kyc">
      <h4>ğŸ”’ KYC pending / rejected</h4>
      <p>PENDING: "Verification in progress (24-48hrs)"<br>REJECTED: "Document rejected: [reason] â€” Resubmit" â†’ PATCH resubmit API.</p>
    </div>
    <div class="nudge-card plan" style="grid-column:span 2;">
      <h4>ğŸš€ Plan upgrade nudge (contextual)</h4>
      <p>Show only when vendor hits a limit: "You've added 2 capabilities. Upgrade to STARTER (â‚¹299/mo) to add more." Not shown proactively.</p>
    </div>
  </div>
</div>

<!-- â•â•â• SECTION 8: THIYA PATTERNS â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">8</span> Thiya â€” Voice Interaction Design</div>
  <p class="sec-sub">Thiya is a floating AI assistant (bottom-right orb). Always visible. Tap orb or say "Thiya" to activate. Voice is primary; form fields are fallback.</p>

  <div class="note thiya"><span class="note-icon">ğŸ§ </span><div><strong>Design principle:</strong> Every screen should be completable with ONE voice sentence. Thiya fills fields, makes smart defaults, and shows a confirmation card. Vendor taps "Looks right!" to proceed. No typing unless they want to edit. In 2026â€“2030, this becomes the only interaction mode â€” design for it now.</div></div>

  <table class="tbl">
    <tr><th>Screen</th><th>Voice Command Example</th><th>Thiya Action</th></tr>
    <tr><td>Profile (S4)</td><td>"My name is Priya, shop name Fresh Tiffin"</td><td>Fill ownerName + businessName, confirm card</td></tr>
    <tr><td>Category (S5)</td><td>"I deliver milk and tiffin daily"</td><td>Auto-select MILK_DELIVERY + TIFFIN_SERVICE</td></tr>
    <tr><td>Zone (S6)</td><td>"I cover 4 km around my house"</td><td>Set radiusKm=4, use GPS for center</td></tr>
    <tr><td>Zone (S6)</td><td>"Mostly south Pune, Sinhagad Road area"</td><td>Geocode location, set as zone center</td></tr>
    <tr><td>KYC (S7)</td><td>"Upload my Aadhaar"</td><td>Open camera/gallery for Aadhaar scan</td></tr>
    <tr><td>Language</td><td>"Mujhe Hindi mein chahiye"</td><td>Set language: HI</td></tr>
    <tr><td>Correction</td><td>"Not 4km, make it 3"</td><td>Thiya updates radius in open confirm card</td></tr>
  </table>

  <div class="note thiya" style="margin-top:0;"><span class="note-icon">ğŸ¤</span><div><strong>Thiya orb states:</strong> Idle = pulsing purple dot. Listening = animated waveform. Processing = spinning. Response = expand to card. Error (not understood) = "I didn't catch that. Try saying it differently." with text input fallback. Always offer manual entry as escape hatch.</div></div>
</div>

<!-- â•â•â• SECTION 9: TOKEN LIFECYCLE â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">9</span> Token Lifecycle & Session Restore</div>

  <div class="api-block" style="margin-bottom:16px;">
<span class="comment">// App opens â†’ check for stored tokens</span>
<span class="method">GET</span> <span class="path">/api/v1/auth/me</span> <span class="comment">â†’ validates token, returns user info</span>

<span class="comment">// 401 on any request â†’ refresh</span>
<span class="method">POST</span> <span class="path">/api/v1/auth/refresh</span>
{ <span class="key">"refreshToken"</span>: <span class="val">"eyJ..."</span> }
<span class="comment">// Response â†’ new accessToken + refreshToken</span>
<span class="comment">// If refresh also 401 â†’ clear tokens â†’ re-login screen</span>

<span class="comment">// Logout (user-initiated)</span>
<span class="method">POST</span> <span class="path">/api/v1/auth/logout</span>
<span class="comment">// JWT is stateless â€” also clear tokens from secure storage client-side</span>
  </div>

  <div class="note warn"><span class="note-icon">ğŸ”</span><div>Store <code>accessToken</code> and <code>refreshToken</code> in <strong>Flutter Secure Storage</strong> (Keychain on iOS, Keystore on Android). Never in SharedPreferences or local storage. Implement an HTTP interceptor that auto-refreshes on 401 before retrying the failed request.</div></div>
</div>

<!-- â•â•â• SECTION 10: STATE MACHINES â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">10</span> State Machines</div>

  <div class="state-grid">
    <div class="state-machine">
      <h4>Vendor Account Status</h4>
      <div class="state-flow">OTP Verify
  â”‚
  â–¼
[ACTIVE] â—„â”€â”€â”€â”€â”€â”€ Admin reactivates
  â”‚    â–²
  â”œâ”€â”€â–º [SUSPENDED]  â† Admin action
  â”‚         â”‚
  â””â”€â”€â–º [DEACTIVATED] â† Vendor request
            â”‚
        (re-login blocked)
      </div>
    </div>
    <div class="state-machine">
      <h4>KYC Status</h4>
      <div class="state-flow">[NOT_APPLIED]
  â”‚ Uploads doc
  â–¼
[PENDING] â”€â”€â”€â”€ Admin reviews
  â”‚    â–²              â”‚
  â”‚    â”‚         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚    â”‚         â–¼         â–¼
  â”‚  Resubmit [APPROVED] [REJECTED]
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Payments unlocked on APPROVED
      </div>
    </div>
    <div class="state-machine">
      <h4>Plan Status</h4>
      <div class="state-flow">[ACTIVE] (FREE default)
  â”‚ Request upgrade
  â–¼
[PENDING approval]
  â”‚ Admin approves
  â–¼
[ACTIVE] (STARTER/GROWTH)
  â”‚ Plan expires
  â–¼
[GRACE_PERIOD] (7 days)
  â”‚ No payment
  â–¼
[FROZEN]
  â”‚ Payment received
  â–¼
[ACTIVE] again
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• SECTION 11: ERRORS & EDGE CASES â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">11</span> Error Handling & Edge Cases</div>

  <table class="tbl">
    <tr><th>HTTP / Scenario</th><th>When</th><th>User-Facing Response</th><th>Dev Action</th></tr>
    <tr><td>400 Bad Request</td><td>Invalid phone format</td><td>Inline: "Enter a valid 10-digit number starting with 6â€“9"</td><td>Client-side validate first</td></tr>
    <tr><td>401 Unauthorized</td><td>Token expired</td><td>Silent auto-refresh. If fails â†’ re-login screen</td><td>Interceptor handles it</td></tr>
    <tr><td>403 Plan Limit</td><td>Capability/zone limit hit</td><td>"You've reached your FREE plan limit. Upgrade to add more."</td><td>Show upgrade CTA, error code: PL01</td></tr>
    <tr><td>422 Duplicate</td><td>Same doc type uploaded twice</td><td>"This document is already uploaded. View existing?"</td><td>Check list before upload</td></tr>
    <tr><td>429 Rate Limit</td><td>OTP resend > 3 times</td><td>"OTP limit reached for today. Try tomorrow."</td><td>Disable resend button, show timer</td></tr>
    <tr><td>500 Server Error</td><td>Backend down</td><td>"Something went wrong. Try again in a moment."</td><td>Retry with exponential backoff</td></tr>
    <tr><td>GPS Denied</td><td>User denies location</td><td>Show address text input instead of map</td><td>Geocode entered address to lat/lng</td></tr>
    <tr><td>Network offline</td><td>No internet</td><td>Banner: "No internet connection. Progress saved locally."</td><td>Cache form data, retry on reconnect</td></tr>
    <tr><td>SUSPENDED account</td><td>Vendor suspended by admin</td><td>"Your account has been suspended. Contact support."</td><td>Block all actions, show support link</td></tr>
    <tr><td>OTP in dev mode</td><td>Testing</td><td>â€”</td><td>OTP is always <code>123456</code> in dev</td></tr>
  </table>
</div>

<!-- â•â•â• SECTION 12: API REFERENCE â•â•â• -->
<div class="section">
  <div class="sec-title"><span class="sec-num">12</span> API Quick Reference â€” Milestone 1</div>

  <table class="tbl">
    <tr><th>Method</th><th>Endpoint</th><th>Auth</th><th>Used In</th><th>Key Notes</th></tr>
    <tr><td>POST</td><td><code class="code">/api/v1/auth/otp/send</code></td><td>None</td><td>Screen 2</td><td>registrationSource: VENDOR_APP mandatory</td></tr>
    <tr><td>POST</td><td><code class="code">/api/v1/auth/otp/verify</code></td><td>None</td><td>Screen 3</td><td>Returns newUser flag. Route on this.</td></tr>
    <tr><td>POST</td><td><code class="code">/api/v1/auth/refresh</code></td><td>None</td><td>Any 401</td><td>Auto-intercept, retry original request</td></tr>
    <tr><td>GET</td><td><code class="code">/api/v1/auth/me</code></td><td>Bearer</td><td>App open</td><td>Session restore on cold start</td></tr>
    <tr><td>POST</td><td><code class="code">/api/v1/auth/logout</code></td><td>Bearer</td><td>Settings</td><td>Also clear tokens client-side</td></tr>
    <tr><td>GET</td><td><code class="code">/api/v1/vendor/profile/me</code></td><td>Bearer</td><td>Dashboard</td><td>Check profile completeness</td></tr>
    <tr><td>PATCH</td><td><code class="code">/api/v1/vendor/profile/me</code></td><td>Bearer</td><td>Screen 4</td><td>Partial update. Only send changed fields.</td></tr>
    <tr><td>GET</td><td><code class="code">/api/v1/vendor/capabilities/catalog</code></td><td>None</td><td>Screen 5</td><td>Public. Load once, cache.</td></tr>
    <tr><td>GET</td><td><code class="code">/api/v1/vendor/capabilities/my</code></td><td>Bearer</td><td>Dashboard</td><td>List vendor's active capabilities</td></tr>
    <tr><td>POST</td><td><code class="code">/api/v1/vendor/capabilities/my</code></td><td>Bearer</td><td>Screen 6</td><td>One call per selected category</td></tr>
    <tr><td>POST</td><td><code class="code">/api/v1/vendor/capabilities/{id}/zones</code></td><td>Bearer</td><td>Screen 6</td><td>After capability created. FREE: only 1 zone.</td></tr>
    <tr><td>PATCH</td><td><code class="code">/api/v1/vendor/capabilities/{id}/pause</code></td><td>Bearer</td><td>Dashboard</td><td>Stop accepting orders temporarily</td></tr>
    <tr><td>PATCH</td><td><code class="code">/api/v1/vendor/capabilities/{id}/resume</code></td><td>Bearer</td><td>Dashboard</td><td>Reopen for orders</td></tr>
    <tr><td>GET</td><td><code class="code">/api/v1/vendor/documents/my</code></td><td>Bearer</td><td>KYC page</td><td>Check status + rejection reason</td></tr>
    <tr><td>POST</td><td><code class="code">/api/v1/vendor/documents/my</code></td><td>Bearer</td><td>Screen 7</td><td>fileId from storage upload first</td></tr>
    <tr><td>PATCH</td><td><code class="code">/api/v1/vendor/documents/my/{id}/resubmit</code></td><td>Bearer</td><td>KYC reject</td><td>Params: newFileId=uuid</td></tr>
    <tr><td>POST</td><td><code class="code">/api/v1/vendors/{vendorId}/plan/requests</code></td><td>Bearer</td><td>Screen 8</td><td>Params: requestedTier=STARTER</td></tr>
  </table>
  <div style="font-size:12px;color:var(--ts);margin-top:8px;">vendorId â†’ from GET /vendor/profile/me response field <code class="code">id</code></div>
</div>

<div style="text-align:center;font-size:12px;color:var(--ts);margin-top:40px;padding-top:20px;border-top:1px solid var(--border);">
  Vinimay Platform Â· Milestone 1 Guide Â· Branch: develop_AS Â· <strong>â†’ Continue to Guide 2: Catalogue Setup & Go Live</strong>
</div>

</div>
<script>
(function() {
  var veil = document.getElementById('auth-veil');
  if (sessionStorage.getItem('thiya_dev_session') === '1') {
    veil.remove();
  } else {
    veil.textContent = 'body{margin:0;background:#FAFAFA;font-family:sans-serif}';
    document.addEventListener('DOMContentLoaded', function() {
      document.body.innerHTML =
        '<div style="min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:28px;padding:24px;text-align:center">' +
          '<div>' +
            '<div style="width:52px;height:52px;background:#FF6B35;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;color:#fff;margin-bottom:20px">th</div>' +
            '<h2 style="color:#111;font-size:22px;font-weight:700;margin-bottom:10px">Restricted Access</h2>' +
            '<p style="color:#666;font-size:14px;line-height:1.7;max-width:300px">This resource is only accessible through the Thiya Developer Portal.</p>' +
          '</div>' +
          '<a href="developer.html" style="display:inline-block;background:#FF6B35;color:#fff;text-decoration:none;padding:13px 28px;border-radius:8px;font-size:14px;font-weight:600">Go to Developer Portal &rarr;</a>' +
        '</div>';
    });
  }
})();
</script>
</body>
</html>
